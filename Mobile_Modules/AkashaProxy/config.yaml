# mihomoæ–‡æ¡£ h(tps://wiki.metacubex.one/config/dns/hosts/#hosts

mode: rule # è§„åˆ™æ¨¡å¼
mixed-port: 7890 # socks/httpä»£ç†ç«¯å£
redir-port: 7892 # redirecté€æ˜ä»£ç†ç«¯å£
tproxy-port: 7893 # tproxyé€æ˜ä»£ç†ç«¯å£
allow-lan: true # å…è®¸å±€åŸŸç½‘è®¿é—®
ipv6: true # å¼€å¯ipv6
unified-delay: true #ç»Ÿä¸€å»¶è¿Ÿ
log-level: info # æ—¥å¿—ç­‰çº§

tcp-concurrent: true # å¯ç”¨ TCP å¹¶å‘è¿æ¥

# TCP Keep Alive è®¾ç½®ï¼Œå‡å°‘è®¾å¤‡è€—ç”µé—®é¢˜
keep-alive-interval: 30
keep-alive-idle: 15

find-process-mode: strict # è¿›ç¨‹æŸ¥æ‰¾æ¨¡å¼
global-client-fingerprint: chrome # å…¨å±€å®¢æˆ·ç«¯æŒ‡çº¹æ¨¡æ‹Ÿä¸º Chrome æµè§ˆå™¨

# è‡ªåŠ¨æ›´æ–°geo
geox-url:
  geosite: https://ghfast.top/https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat
  mmdb: https://ghfast.top/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/GeoLite2-Country.mmdb
  geoip: https://ghfast.top/https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/geoip.dat
  asn: https://ghfast.top/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/GeoLite2-ASN.mmdb
geo-auto-update: true
geo-update-interval: 6

# åŸŸåå—…æ¢ https://wiki.metacubex.one/config/sniff/#_1
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - Mijia Cloud
    - "+.push.apple.com"

# ç¼“å­˜
profile:
  store-selected: true
  # å‚¨å­˜ API å¯¹ç­–ç•¥ç»„çš„é€‰æ‹©ï¼Œä»¥ä¾›ä¸‹æ¬¡å¯åŠ¨æ—¶ä½¿ç”¨
  store-fake-ip: true
  # å‚¨å­˜ fakeip æ˜ å°„è¡¨ï¼ŒåŸŸåå†æ¬¡å‘ç”Ÿè¿æ¥æ—¶ï¼Œä½¿ç”¨åŸæœ‰æ˜ å°„åœ°å€

# è‡ªåŠ¨åŒæ­¥æ—¶é—´ä»¥é˜²æ­¢æ—¶é—´ä¸å‡†å¯¼è‡´æ— æ³•æ­£å¸¸è”ç½‘
ntp:
  enable: true
  # æ˜¯å¦åŒæ­¥è‡³ç³»ç»Ÿæ—¶é—´ï¼Œéœ€è¦ root/ç®¡ç†å‘˜æƒé™
  write-to-system: false
  server: time.apple.com
  port: 123
  interval: 30

# ç®¡ç†é¡µé¢ https://wiki.metacubex.one/config/general/#_7
external-controller: 127.0.0.1:9090
# external-ui: yacd
external-ui: zashboard #ä½¿ç”¨zashboardä¸ºæœ¬åœ°ç®¡ç†ui
external-ui-url: "https://ghfast.top/https://github.com/Zephyruso/zashboard/releases/latest/download/dist-no-fonts.zip"
bind-address: "*"

# tunè™šæ‹Ÿç½‘å¡è®¾ç½® ä¸æ‡‚é»˜è®¤å°±å¥½ é»˜è®¤å¼€å¯tun
tun:
  enable: true
  device: mihoyo
  stack: mixed
  auto-route: true # è‡ªåŠ¨æ·»åŠ è·¯ç”±
  strict-route: true # ä¸¥æ ¼è·¯ç”±æ¨¡å¼
  endpoint-independent-nat: true # å¯ç”¨ç«¯ç‚¹ç‹¬ç«‹ NAT
  auto-redirect: true # è‡ªåŠ¨é‡å®šå‘æµé‡åˆ° TUN è®¾å¤‡
  auto-detect-interface: true # è‡ªåŠ¨æ£€æµ‹ç½‘ç»œæ¥å£
  dns-hijack: 
    - any:53


# https://wiki.metacubex.one/config/dns/hosts/#hosts
hosts:
  doh.pub: [1.12.12.21, 120.53.53.53, 1.12.12.12]
  dot.pub: [1.12.12.21, 120.53.53.53, 1.12.12.12]
  "*.alidns.com": [223.5.5.5, 223.6.6.6, 2400:3200::1, 2400:3200:baba::1]
  dns.google: [8.8.8.8, 8.8.4.4, 2001:4860:4860::8888, 2001:4860:4860::8844]
  cloudflare-dns.com: [1.1.1.1, 1.0.0.1, 2606:4700:4700::1111, 2606:4700:4700::1001]
  "*.cloudflare-gateway.com": [162.159.36.20, 162.159.36.5, 2606:4700:5c::a29f:2e07, 2606:4700:54::a29f:2407]

dns:
  enable: true
  listen: 0.0.0.0:1053
  cache-algorithm: arc # DNS ç¼“å­˜ç®—æ³•
  ipv6: false # å¯ç”¨ IPv6 è§£æ
  respect-rules: true # éµå¾ªåˆ†æµè§„åˆ™
  enhanced-mode: redir-host
  fake-ip-filter-mode: blacklist
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
    - https://1.12.12.21/dns-query
    - https://223.5.5.5/dns-query
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://xxxxxxxxxx.cloudflare-gateway.com/dns-query
  proxy-server-nameserver:
    - https://doh.pub/dns-query
  nameserver-policy:
    "geosite:cn,private":
      - https://dot.pub/dns-query
      - https://dns.alidns.com/dns-query
    "geosite:geolocation-!cn,gfw,!cn":
      - https://dns.google/dns-query
      - https://xxxxxxxxxx.cloudflare-gateway.com/dns-query


proxies:
# mihomoé…ç½®å‚è€ƒå¯ä»¥çœ‹çœ‹è¿™ä¸ªwiki
# https://wiki.metacubex.one

#é¢„è®¾
pr: &pr
  type: select
  interval: 3600
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    interval: 300
    timeout: 3000
  include-all: true


autotest: &autotest
  type: url-test
  interval: 300
  tolerance: 100
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    interval: 120
    timeout: 3000
  include-all: true


p: &p
  type: http
  interval: 3600
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    timeout: 1500
    interval: 300
    lazy: true

# ä»£ç†æä¾›(è®¢é˜…)ç»„
# url é‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤
proxy-providers:
  æœºåœº1: #æœºåœºå
    <<: *p
    url: "https://example.com/airport"
    # path: ./proxy_providers/jichang1.yaml #æŒ‡å®šä¿å­˜è·¯å¾„ éå¿…å¡«

  # æœºåœº2: #æœºåœºå
    # <<: *p
    # url: "è¿™é‡Œå¡«æœºåœºè®¢é˜…"
    # path: ./proxy_providers/jichang2.yaml #ä¿å­˜è·¯å¾„

# ä»£ç†ç»„
proxy-groups:
  - name: ä»£ç†è®¾ç½®
    type: select
    proxies:
      - å›½å†…åˆ†æµ
      - é¦™æ¸¯
      - å°æ¹¾
      - æ—¥æœ¬
      - æ–°åŠ å¡
      - ç¾å›½
      - å…¨éƒ¨èŠ‚ç‚¹

  - name: å›½å†…åˆ†æµ
    type: select
    proxies:
      - DIRECT
      - ä¸­å›½

  - name: å±è”½
    type: select
    proxies:
      - REJECT-DROP
      - REJECT
      - DIRECT

  - name: AIåˆ†æµ
    type: select
    proxies:
      - ä»£ç†è®¾ç½®
      - é¦™æ¸¯
      - å°æ¹¾
      - æ—¥æœ¬
      - æ–°åŠ å¡
      - è‹±å›½
      - ç¾å›½
      - å…¨éƒ¨èŠ‚ç‚¹


# æŒ‰ç…§åŒºåŸŸåˆ’å®šç­–ç•¥ç»„
  - {name: ä¸­å›½, <<: *pr, proxies: [ä¸­å›½è‡ªåŠ¨é€‰æ‹©], filter: "(?i)(ğŸ‡¨ğŸ‡³|ä¸­å›½|cn|china|CN)", exclude-filter: "(?i)(å°æ¹¾|tw|taiwan|TW)"}
  - {name: é¦™æ¸¯, <<: *pr, proxies: [é¦™æ¸¯è‡ªåŠ¨é€‰æ‹©], filter: "(?i)(ğŸ‡­ğŸ‡°|é¦™æ¸¯|hk|hongkong|hong kong|HK)"}
  - {name: å°æ¹¾, <<: *pr, proxies: [å°æ¹¾è‡ªåŠ¨é€‰æ‹©], filter: "(?i)(å°æ¹¾|tw|taiwan|TW)"}
  - {name: æ—¥æœ¬, <<: *pr, proxies: [æ—¥æœ¬è‡ªåŠ¨é€‰æ‹©], filter: "(?i)(ğŸ‡¯ğŸ‡µ|æ—¥|jp|japan|JP)"}
  - {name: ç¾å›½, <<: *pr, proxies: [ç¾å›½è‡ªåŠ¨é€‰æ‹©], filter: "(?i)(ğŸ‡ºğŸ‡¸|ç¾|us|unitedstates|united states|US)"}
  - {name: è‹±å›½, <<: *pr, proxies: [è‹±å›½è‡ªåŠ¨é€‰æ‹©], filter: "(?i)(ğŸ‡¬ğŸ‡§|è‹±å›½|uk|è‹±å›½|England|UK)"}
  - {name: æ–°åŠ å¡, <<: *pr, proxies: [æ–°åŠ å¡è‡ªåŠ¨é€‰æ‹©], filter: "(?i)(ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|sg|singapore|SG)"}
  - {name: å…¨éƒ¨èŠ‚ç‚¹, proxies: [è‡ªåŠ¨é€‰æ‹©], <<: *pr}
  # ä¸‹é¢è¿™æ®µä¸ºè‡ªåŠ¨é€‰æ‹©ä¸ä¼šåœ¨é¢æ¿æ˜¾ç¤º å¦‚æœæ˜¾ç¤ºäº†è¯´æ˜ä½ çš„é¢æ¿ä¸æ”¯æŒhiddenå­—æ®µ
  - {name: ä¸­å›½è‡ªåŠ¨é€‰æ‹©, <<: *autotest, hidden: true, filter: "(?i)(ğŸ‡¨ğŸ‡³|ä¸­å›½|cn|china|CN)", exclude-filter: "(?i)(å°æ¹¾|tw|taiwan|TW)"}
  - {name: é¦™æ¸¯è‡ªåŠ¨é€‰æ‹©, <<: *autotest, hidden: true, filter: "(?i)(ğŸ‡­ğŸ‡°|é¦™æ¸¯|hk|hongkong|hong kong|HK)"}
  - {name: å°æ¹¾è‡ªåŠ¨é€‰æ‹©, <<: *autotest, hidden: true, filter: "(?i)(å°æ¹¾|tw|taiwan|TW)"}
  - {name: æ—¥æœ¬è‡ªåŠ¨é€‰æ‹©, <<: *autotest, hidden: true, filter: "(?i)(ğŸ‡¯ğŸ‡µ|æ—¥|jp|japan|JP)"}
  - {name: ç¾å›½è‡ªåŠ¨é€‰æ‹©, <<: *autotest, hidden: true, filter: "(?i)(ğŸ‡ºğŸ‡¸|ç¾|us|unitedstates|united states|US)"}
  - {name: è‹±å›½è‡ªåŠ¨é€‰æ‹©, <<: *autotest, hidden: true, filter: "(?i)(ğŸ‡¬ğŸ‡§|è‹±å›½|uk|è‹±å›½|England|UK)"}
  - {name: æ–°åŠ å¡è‡ªåŠ¨é€‰æ‹©, <<: *autotest, hidden: true, filter: "(?i)(ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|sg|singapore|SG)"}
  - {name: è‡ªåŠ¨é€‰æ‹©, <<: *autotest, hidden: true}

# åˆ†æµè§„åˆ™æä¾›(è®¢é˜…)ç»„
rule-providers:
  AWAvenue:
    type: http
    behavior: classical
    format: yaml
    path: ./rule_providers/AWAvenue-Ads-Rule-Clash.yaml
    url: "https://gcore.jsdelivr.net/gh/TG-Twilight/AWAvenue-Ads-Rule@main/Filters/AWAvenue-Ads-Rule-Clash-Classical.yaml"
    interval: 60480

# åˆ†æµè§„åˆ™
rules:

  - AND,((NOT,((OR,((PROCESS-NAME,mihomo),(PROCESS-NAME,ClashMeta))))),(DST-PORT,853)),å±è”½ #ç¦æ­¢émihomoè®¿é—®dot dns
  - GEOSITE,category-httpdns-cn,å±è”½ #å±è”½httpdnsé˜²æ­¢å»å¹¿å‘Šå¤±æ•ˆ
  - RULE-SET,AWAvenue,å±è”½ #å»å¹¿å‘Š
  - IP-CIDR,203.107.1.0/24,å±è”½,no-resolve # é˜¿é‡Œäº‘ip httpdns

  - GEOSITE,private,å›½å†…åˆ†æµ
  - GEOSITE,connectivity-check,å›½å†…åˆ†æµ
  - GEOSITE,googlefcm,å›½å†…åˆ†æµ
  - GEOSITE,category-games@cn,å›½å†…åˆ†æµ
  - GEOSITE,cn,å›½å†…åˆ†æµ
  - GEOIP,PRIVATE,å›½å†…åˆ†æµ,no-resolve
  - GEOIP,cn,å›½å†…åˆ†æµ,no-resolve
  - GEOSITE,category-ai-!cn,AIåˆ†æµ
  - GEOSITE,geolocation-!cn,ä»£ç†è®¾ç½®
  - MATCH,ä»£ç†è®¾ç½®

